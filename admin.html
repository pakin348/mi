<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üîê Admin Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .login-container {
        max-width: 400px;
        margin: 100px auto;
        background: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .login-container h1 {
        text-align: center;
        color: #667eea;
        margin-bottom: 30px;
      }

      .dashboard {
        display: none;
        max-width: 1400px;
        margin: 0 auto;
      }

      .dashboard.active {
        display: block;
      }

      .header {
        background: white;
        padding: 20px 30px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header h1 {
        color: #667eea;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .stat-card h3 {
        color: #667eea;
        font-size: 1.1em;
        margin-bottom: 10px;
      }

      .stat-card .number {
        font-size: 2.5em;
        font-weight: bold;
        color: #333;
      }

      .stat-card .new-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #ff4757;
        color: white;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.8em;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .content-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .card h2 {
        color: #667eea;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .message-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        border-left: 4px solid #667eea;
        animation: slideIn 0.3s;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .message-item.new {
        background: #fff5f5;
        border-left-color: #ff4757;
      }

      .message-meta {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 0.9em;
        color: #666;
      }

      .message-text {
        color: #333;
        line-height: 1.6;
      }

      .anonymous-badge {
        background: #ffd700;
        color: #333;
        padding: 3px 8px;
        border-radius: 5px;
        font-size: 0.8em;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        margin: 8px 0;
        font-size: 1em;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1em;
        transition: transform 0.2s;
        width: 100%;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      .btn-logout {
        background: #ff4757;
        width: auto;
      }

      .empty-state {
        text-align: center;
        padding: 40px;
        color: #999;
      }

      .empty-state .emoji {
        font-size: 4em;
        margin-bottom: 10px;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #667eea;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .tab-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .tab-btn {
        padding: 10px 20px;
        border: 2px solid #e0e0e0;
        background: white;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .tab-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: transparent;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .mood-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 10px;
      }

      .mood-emoji {
        font-size: 2em;
      }

      .mood-details {
        flex: 1;
      }

      @media (max-width: 768px) {
        .stats-grid {
          grid-template-columns: 1fr;
        }

        .header {
          flex-direction: column;
          gap: 15px;
        }
      }

      .notification-dot {
        position: absolute;
        top: -5px;
        right: -5px;
        width: 12px;
        height: 12px;
        background: #ff4757;
        border-radius: 50%;
        border: 2px solid white;
        animation: pulse 2s infinite;
      }
    </style>
  </head>
  <body>
    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
      <h1>üîê Admin Login</h1>
      <input type="password" id="passwordInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" />
      <button class="btn" onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      <p
        style="
          margin-top: 15px;
          text-align: center;
          color: #999;
          font-size: 0.9em;
        "
      >
        ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: <strong>admin123</strong>
      </p>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
      <div class="header">
        <div>
          <h1>üìä Admin Dashboard</h1>
          <p style="color: #666; margin-top: 5px">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
        </div>
        <button class="btn btn-logout" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>

      <!-- Statistics -->
      <div class="stats-grid">
        <div class="stat-card">
          <h3>üí¨ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
          <div class="number" id="totalMessages">0</div>
          <div class="new-badge" id="newMessagesBadge" style="display: none">
            ‡πÉ‡∏´‡∏°‡πà!
          </div>
        </div>
        <div class="stat-card">
          <h3>üòä ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h3>
          <div class="number" id="totalMoods">0</div>
        </div>
        <div class="stat-card">
          <h3>üí≠ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</h3>
          <div class="number" id="totalAnswers">0</div>
        </div>
        <div class="stat-card">
          <h3>üë• ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
          <div class="number" id="totalUsers">0</div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="card">
        <div class="tab-buttons">
          <button class="tab-btn active" onclick="switchTab('messages')">
            üí¨ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
          </button>
          <button class="tab-btn" onclick="switchTab('moods')">
            üòä ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå
          </button>
          <button class="tab-btn" onclick="switchTab('questions')">
            üí≠ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
          </button>
          <button class="tab-btn" onclick="switchTab('survey')">
            üìä ‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°
          </button>
          <button class="tab-btn" onclick="switchTab('suggestions')">
            üí° ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
          </button>
        </div>

        <!-- Messages Tab -->
        <div id="messagesTab" class="tab-content active">
          <h2>üí¨ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
          <div id="messagesList" class="loading">
            <div class="spinner"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
          </div>
        </div>

        <!-- Moods Tab -->
        <div id="moodsTab" class="tab-content">
          <h2>üòä ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô</h2>
          <div id="moodsList" class="loading">
            <div class="spinner"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
          </div>
        </div>

        <!-- Questions Tab -->
        <div id="questionsTab" class="tab-content">
          <h2>üí≠ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</h2>
          <div id="questionsList" class="loading">
            <div class="spinner"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
          </div>
        </div>

        <!-- Survey Tab -->
        <div id="surveyTab" class="tab-content">
          <h2>üìä ‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°</h2>
          <div id="surveyList" class="loading">
            <div class="spinner"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
          </div>
        </div>

        <!-- Suggestions Tab -->
        <div id="suggestionsTab" class="tab-content">
          <h2>üí° ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
          <div id="suggestionsList" class="loading">
            <div class="spinner"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
      // Firebase Configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDGEmvKwaH3BYBtAbmqRUdva90aypPNRJw",
        authDomain: "monday-3d5c1.firebaseapp.com",
        projectId: "monday-3d5c1",
        storageBucket: "monday-3d5c1.firebasestorage.app",
        messagingSenderId: "32338827684",
        appId: "1:32338827684:web:88378c70a16240dd3fc931",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Admin password (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ)
      const ADMIN_PASSWORD = "admin123";

      // Previous message count for notification
      let previousMessageCount = 0;

      // Login
      function login() {
        const password = document.getElementById("passwordInput").value;
        if (password === ADMIN_PASSWORD) {
          document.getElementById("loginContainer").style.display = "none";
          document.getElementById("dashboard").classList.add("active");
          loadDashboard();

          // Setup real-time listener
          setupRealtimeListener();
        } else {
          alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!");
        }
      }

      // Logout
      function logout() {
        document.getElementById("loginContainer").style.display = "block";
        document.getElementById("dashboard").classList.remove("active");
        document.getElementById("passwordInput").value = "";
      }

      // Allow Enter key to login
      document
        .getElementById("passwordInput")
        ?.addEventListener("keypress", (e) => {
          if (e.key === "Enter") login();
        });

      // Switch tabs
      function switchTab(tabName) {
        // Update buttons
        document.querySelectorAll(".tab-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        event.target.classList.add("active");

        // Update content
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.remove("active");
        });
        document.getElementById(tabName + "Tab").classList.add("active");
      }

      // Load dashboard data
      async function loadDashboard() {
        try {
          const usersSnapshot = await db.collection("users").get();

          let totalMessages = 0;
          let totalMoods = 0;
          let totalAnswers = 0;
          let allMessages = [];
          let allMoods = [];
          let allQuestions = [];
          let allSurveys = [];
          let allSuggestions = [];

          usersSnapshot.forEach((doc) => {
            const data = doc.data();
            const userId = doc.id;

            // Messages
            if (data.responses?.messages) {
              totalMessages += data.responses.messages.length;
              data.responses.messages.forEach((msg) => {
                allMessages.push({ ...msg, userId });
              });
            }

            // Moods
            if (data.responses?.mood) {
              totalMoods += data.responses.mood.length;
              data.responses.mood.forEach((mood) => {
                allMoods.push({ ...mood, userId });
              });
            }

            // Questions
            if (
              data.responses?.questions &&
              Object.keys(data.responses.questions).length > 0
            ) {
              totalAnswers++;
              allQuestions.push({ ...data.responses.questions, userId });
            }

            // Survey
            if (
              data.responses?.survey &&
              Object.keys(data.responses.survey).length > 0
            ) {
              allSurveys.push({ ...data.responses.survey, userId });
            }

            // Suggestions
            if (data.responses?.dateSuggestions) {
              data.responses.dateSuggestions.forEach((sug) => {
                allSuggestions.push({ ...sug, userId, type: "date" });
              });
            }
            if (data.responses?.musicSuggestions) {
              data.responses.musicSuggestions.forEach((sug) => {
                allSuggestions.push({ ...sug, userId, type: "music" });
              });
            }
          });

          // Update stats
          document.getElementById("totalMessages").textContent = totalMessages;
          document.getElementById("totalMoods").textContent = totalMoods;
          document.getElementById("totalAnswers").textContent = totalAnswers;
          document.getElementById("totalUsers").textContent =
            usersSnapshot.size;

          // Show new message badge
          if (
            totalMessages > previousMessageCount &&
            previousMessageCount > 0
          ) {
            document.getElementById("newMessagesBadge").style.display = "block";
          }
          previousMessageCount = totalMessages;

          // Display data
          displayMessages(allMessages);
          displayMoods(allMoods);
          displayQuestions(allQuestions);
          displaySurveys(allSurveys);
          displaySuggestions(allSuggestions);
        } catch (error) {
          console.error("Error loading dashboard:", error);
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + error.message);
        }
      }

      // Display messages
      function displayMessages(messages) {
        const container = document.getElementById("messagesList");

        if (messages.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">üí¨</div>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>
                    </div>
                `;
          return;
        }

        // Sort by date (newest first)
        messages.sort((a, b) => new Date(b.date) - new Date(a.date));

        container.innerHTML = messages
          .map(
            (msg) => `
                <div class="message-item">
                    <div class="message-meta">
                        <span>
                            ${
                              msg.anonymous
                                ? '<span class="anonymous-badge">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠</span>'
                                : ""
                            }
                            User: ${msg.userId.substring(0, 10)}...
                        </span>
                        <span>${new Date(msg.date).toLocaleString(
                          "th-TH"
                        )}</span>
                    </div>
                    <div class="message-text">${msg.message}</div>
                </div>
            `
          )
          .join("");
      }

      // Display moods
      function displayMoods(moods) {
        const container = document.getElementById("moodsList");

        if (moods.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">üòä</div>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</p>
                    </div>
                `;
          return;
        }

        moods.sort((a, b) => new Date(b.date) - new Date(a.date));

        container.innerHTML = moods
          .map(
            (mood) => `
                <div class="mood-item">
                    <div class="mood-emoji">${mood.mood.split(" ")[0]}</div>
                    <div class="mood-details">
                        <strong>${mood.mood}</strong>
                        <p style="color: #666; margin-top: 5px;">${
                          mood.note || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏ô‡πâ‡∏ï"
                        }</p>
                        <small style="color: #999;">${new Date(
                          mood.date
                        ).toLocaleString("th-TH")}</small>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Display questions
      function displayQuestions(questions) {
        const container = document.getElementById("questionsList");

        if (questions.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">üí≠</div>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = questions
          .map(
            (q) => `
                <div class="message-item">
                    <div class="message-meta">
                        <span>User: ${q.userId.substring(0, 10)}...</span>
                        <span>${
                          q.timestamp
                            ? new Date(q.timestamp).toLocaleString("th-TH")
                            : "N/A"
                        }</span>
                    </div>
                    <div style="margin-top: 10px;">
                        ${
                          q.q1
                            ? `<p><strong>‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö:</strong> ${q.q1}</p>`
                            : ""
                        }
                        ${
                          q.q2
                            ? `<p><strong>‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö:</strong> ${q.q2}</p>`
                            : ""
                        }
                        ${
                          q.q3
                            ? `<p><strong>‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏´‡∏¢‡∏∏‡∏î 1 ‡∏ß‡∏±‡∏ô:</strong> ${q.q3}</p>`
                            : ""
                        }
                        ${
                          q.q4
                            ? `<p><strong>‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç:</strong> ${q.q4}</p>`
                            : ""
                        }
                        ${
                          q.q5
                            ? `<p><strong>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</strong> ${q.q5}</p>`
                            : ""
                        }
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Display surveys
      function displaySurveys(surveys) {
        const container = document.getElementById("surveyList");

        if (surveys.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">üìä</div>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°</p>
                    </div>
                `;
          return;
        }

        const scoreLabels = {
          5: "‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê",
          4: "‡∏°‡∏≤‡∏Å ‚≠ê‚≠ê‚≠ê‚≠ê",
          3: "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‚≠ê‚≠ê‚≠ê",
          2: "‡∏ô‡πâ‡∏≠‡∏¢ ‚≠ê‚≠ê",
          1: "‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚≠ê",
        };

        container.innerHTML = surveys
          .map(
            (s) => `
                <div class="message-item">
                    <div class="message-meta">
                        <span>User: ${s.userId.substring(0, 10)}...</span>
                        <span>${
                          s.date
                            ? new Date(s.date).toLocaleString("th-TH")
                            : "N/A"
                        }</span>
                    </div>
                    <div style="margin-top: 10px;">
                        ${
                          s.q1
                            ? `<p><strong>‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢:</strong> ${
                                scoreLabels[s.q1]
                              }</p>`
                            : ""
                        }
                        ${
                          s.q2
                            ? `<p><strong>‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡∏î‡∏µ‡πÑ‡∏´‡∏°:</strong> ${
                                scoreLabels[s.q2]
                              }</p>`
                            : ""
                        }
                        ${
                          s.q3
                            ? `<p><strong>‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡∏ï‡πà‡∏≠‡πÑ‡∏´‡∏°:</strong> ${
                                scoreLabels[s.q3]
                              }</p>`
                            : ""
                        }
                        ${
                          s.q4
                            ? `<p><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å:</strong> ${s.q4}</p>`
                            : ""
                        }
                        ${
                          s.q1 && s.q2 && s.q3
                            ? `<p><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°:</strong> ${
                                parseInt(s.q1) + parseInt(s.q2) + parseInt(s.q3)
                              }/15</p>`
                            : ""
                        }
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Display suggestions
      function displaySuggestions(suggestions) {
        const container = document.getElementById("suggestionsList");

        if (suggestions.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">üí°</div>
                        <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</p>
                    </div>
                `;
          return;
        }

        suggestions.sort((a, b) => new Date(b.date) - new Date(a.date));

        container.innerHTML = suggestions
          .map(
            (s) => `
                <div class="message-item">
                    <div class="message-meta">
                        <span>${
                          s.type === "date" ? "üíë ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏ó" : "üéµ ‡πÄ‡∏û‡∏•‡∏á"
                        }</span>
                        <span>${new Date(s.date).toLocaleString("th-TH")}</span>
                    </div>
                    <div class="message-text">${s.suggestion}</div>
                </div>
            `
          )
          .join("");
      }

      // Setup real-time listener
      function setupRealtimeListener() {
        db.collection("users").onSnapshot(
          (snapshot) => {
            console.log("üîÑ Database updated! Reloading...");
            loadDashboard();
          },
          (error) => {
            console.error("Error in real-time listener:", error);
          }
        );
      }

      // Play notification sound (optional)
      function playNotificationSound() {
        const audio = new Audio(
          "data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZUQ4NY6zn77BdGAg+ltryxncsB"
        );
        audio.play().catch(() => {});
      }
    </script>
  </body>
</html>
